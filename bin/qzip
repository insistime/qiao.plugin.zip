#!/usr/bin/env node

'use strict';

// qiao
var qiao = {};
qiao.cli = require('qiao.plugin.cli');
qiao.zip = require('../lib/qiao.plugin.zip');

// cmd for common
qiao.cli.cmd
	.version(require('../package.json').version, '-v, --version')
	.description('qiao.plugin.zip, nodejs zip and unzip tool')
	.usage('<command>');

// cmd for unzip
qiao.cli.cmd
	.command('unzip <zipFile> <destFolder>')
	.alias('un')
	.description('unzip zip file to dest folder')
	.action(unzip);

// cmd for zip file
qiao.cli.cmd
	.command('zipfile <sourceFile> <destZip>')
	.alias('fi')
	.description('zip source file to dest zip path')
	.action(zipFile);

// cmd for zip folder
qiao.cli.cmd
	.command('zipfolder <sourceFolder> <destZip>')
	.alias('fo')
	.description('zip source folder to dest zip path')
	.action(zipFolder);

// parse
qiao.cli.cmd.parse(process.argv);

// output help
if(!process.argv.slice(2).length){
	qiao.cli.cmd.outputHelp(function(txt){
		return qiao.cli.colors.green(txt);
	});
}

// unzip
function unzip(path1, path2){
	try{
		console.log('unzip ' + path1);
		console.log('to ' + path2);
		console.log();
	
		console.log('please wait a moment...');
		console.log();
		
		qiao.zip.unzip(path1, path2);
		console.log('unzip success!');
	}catch(e){
		console.log(e);
	}
};

// zip file
async function zipFile(path1, path2){
	try{
		console.log('zip file ' + path1);
		console.log('in ' + path2);
		console.log();
		
		console.log('please wait a moment...');
		console.log();
		
		var msg = await qiao.zip.zipFileSync(path1, path2);
		console.log(msg);
	}catch(e){
		console.log(e);
	}
	
	return;
};

// zip folder
async function zipFolder(path1, path2){
	try{
		console.log('zip folder ' + path1);
		console.log('in ' + path2);
		console.log();
		
		console.log('please wait a moment...');
		console.log();
	
		var msg = await qiao.zip.zipFolderSync(path1, path2);
		console.log(msg);
	}catch(e){
		console.log(e);
	}
};